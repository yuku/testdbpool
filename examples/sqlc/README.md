# sqlc Example

This example demonstrates how to use testdbpool with [sqlc](https://github.com/sqlc-dev/sqlc) for type-safe SQL queries.

## Structure

```
examples/sqlc/
├── sql/
│   ├── schema.sql         # Database schema
│   ├── seed.sql          # Initial seed data
│   └── queries/          # SQL queries for sqlc
│       ├── users.sql
│       ├── posts.sql
│       └── comments.sql
├── db/                   # Generated Go code from sqlc
├── sqlc.yaml            # sqlc configuration
├── go.mod
├── main_test.go         # Test files using testdbpool
└── README.md
```

## Features

- Type-safe database queries generated by sqlc
- Blog API schema with users, posts, and comments
- Comprehensive test coverage including:
  - CRUD operations for all entities
  - Transaction support
  - Concurrent access testing
  - Connection pooling

## Running the Example

1. Install sqlc (if not already installed):
   ```bash
   go install github.com/sqlc-dev/sqlc/cmd/sqlc@latest
   ```

2. Generate Go code from SQL:
   ```bash
   sqlc generate
   ```

3. Run the tests:
   ```bash
   go test -v
   ```

## Key Concepts

### Schema Definition

The schema is defined in `sql/schema.sql` and includes:
- Users table with authentication fields
- Posts table with publishing support
- Comments table for user interactions
- Proper indexes and foreign key constraints
- Automatic timestamp updates via triggers

### Query Organization

SQL queries are organized by entity in the `sql/queries/` directory:
- `users.sql` - User management queries
- `posts.sql` - Blog post operations
- `comments.sql` - Comment functionality

### Type Safety

sqlc generates Go code that provides:
- Type-safe query methods
- Proper null handling with sql.NullString, sql.NullTime, etc.
- Interface-based design for easy mocking
- Support for both `database/sql` and `pgx` drivers

### Testing with testdbpool

The example shows how to:
- Initialize testdbpool with schema and seed data
- Use `ResetByTruncate` for fast test isolation
- Handle concurrent test execution
- Work with sqlc-generated code in tests

## Configuration

The `sqlc.yaml` configuration uses:
- PostgreSQL engine
- `database/sql` package for compatibility with testdbpool
- JSON tags for API serialization
- Interface generation for testability